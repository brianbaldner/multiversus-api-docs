!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).BbobParser={})}(this,(function(t){"use strict";var n={},e={};Object.defineProperty(e,"__esModule",{value:!0});var r=e.BACKSLASH=e.PLACEHOLDER_SPACE=e.PLACEHOLDER_SPACE_TAB=l=e.SLASH=e.CLOSE_BRAKET=e.OPEN_BRAKET=e.SPACE=e.QUOTEMARK=e.EQ=e.TAB=e.R=e.F=e.N=void 0,o=e.N="\n";e.F="\f",e.R="\r";var i=e.TAB="\t",a=e.EQ="=",u=e.QUOTEMARK='"',c=e.SPACE=" ",s=e.OPEN_BRAKET="[",f=e.CLOSE_BRAKET="]",l=e.SLASH="/";e.PLACEHOLDER_SPACE_TAB="    ",e.PLACEHOLDER_SPACE=" ",r=e.BACKSLASH="\\";var g={};Object.defineProperty(g,"__esModule",{value:!0}),g.isEOL=g.isStringNode=E=g.isTagNode=g.getUniqAttr=g.getNodeLength=g.escapeHTML=g.appendToNode=g.attrValue=g.attrsToString=void 0;var v=e;function p(t){return function(t){if(Array.isArray(t)){for(var n=0,e=Array(t.length);t.length>n;n++)e[n]=t[n];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var h=function(t){return"object"==typeof t&&!!t.tag},d=function(t){return"string"==typeof t},y=function(t,n,e){return Object.keys(t).reduce(n,e)},T=function(t){return h(t)?t.content.reduce((function(t,n){return t+T(n)}),0):d(t)?t.length:0},b=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/(javascript):/gi,"$1%3A")},A=function(t,n){var e,r=void 0===n?"undefined":(e=n)&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e,o={boolean:function(){return n?"".concat(t):""},number:function(){return"".concat(t,'="').concat(n,'"')},string:function(){return"".concat(t,'="').concat(b(n),'"')},object:function(){return"".concat(t,'="').concat(b(JSON.stringify(n)),'"')}};return o[r]?o[r]():""};g.attrsToString=function(t){return null==t?"":y(t,(function(n,e){return p(n).concat([A(e,t[e])])}),[""]).join(" ")},g.attrValue=A,g.appendToNode=function(t,n){t.content.push(n)},g.escapeHTML=b,g.getNodeLength=T,g.getUniqAttr=function(t){return y(t,(function(n,e){return t[e]===e?t[e]:null}),null)};var E=g.isTagNode=h;g.isStringNode=d,g.isEOL=function(t){return t===v.N},Object.defineProperty(n,"__esModule",{value:!0});var k=n.default=t.TagNode=n.TagNode=void 0,O=e,S=g;function N(t,n){for(var e=0;n.length>e;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function L(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}var C=function(t,n){var e=S.getUniqAttr(n);if(e){var r=S.attrValue(t,e),o=function(t){for(var n=1;arguments.length>n;n++){var e=null!=arguments[n]?arguments[n]:{},r=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(e).filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})))),r.forEach((function(n){L(t,n,e[n])}))}return t}({},n);delete o[e];var i=S.attrsToString(o);return"".concat(r).concat(i)}return"".concat(t).concat(S.attrsToString(n))},m=function(){function t(n,e,r){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.tag=n,this.attrs=e,this.content=Array.isArray(r)?r:[r]}var n,e,r;return n=t,(e=[{key:"attr",value:function(t,n){return void 0!==n&&(this.attrs[t]=n),this.attrs[t]}},{key:"append",value:function(t){return S.appendToNode(this,t)}},{key:"length",get:function(){return S.getNodeLength(this)}},{key:"toTagStart",value:function(t){var n=void 0===t?{}:t,e=n.openTag,r=void 0===e?O.OPEN_BRAKET:e,o=n.closeTag,i=void 0===o?O.CLOSE_BRAKET:o,a=C(this.tag,this.attrs);return"".concat(r).concat(a).concat(i)}},{key:"toTagEnd",value:function(t){var n=void 0===t?{}:t,e=n.openTag,r=n.closeTag,o=void 0===r?O.CLOSE_BRAKET:r;return"".concat(void 0===e?O.OPEN_BRAKET:e).concat(O.SLASH).concat(this.tag).concat(o)}},{key:"toTagNode",value:function(){return new t(this.tag.toLowerCase(),this.attrs,this.content)}},{key:"toString",value:function(t){var n=void 0===t?{}:t,e=n.openTag,r=void 0===e?O.OPEN_BRAKET:e,o=n.closeTag,i=void 0===o?O.CLOSE_BRAKET:o,a=0===this.content.length,u=this.content.reduce((function(t,n){return t+n.toString({openTag:r,closeTag:i})}),""),c=this.toTagStart({openTag:r,closeTag:i});return a?c:"".concat(c).concat(u).concat(this.toTagEnd({openTag:r,closeTag:i}))}}])&&N(n.prototype,e),r&&N(n,r),t}();function P(t,n){for(var e=0;n.length>e;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}m.create=function(t,n,e){return new m(t,void 0===n?{}:n,void 0===e?[]:e)},m.isOf=function(t,n){return t.tag===n},t.TagNode=n.TagNode=m,k=n.default=m;var w=function(t){return t&&void 0!==t.value?t.value:""},_=function(t){return w(t).charCodeAt(0)===l.charCodeAt(0)},x=function(){function t(n,e,r,o){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.type=Number(n),this.value=e+"",this.line=Number(r),this.row=Number(o)}var n,e,r;return n=t,(e=[{key:"isEmpty",value:function(){return isNaN(this.type)}},{key:"isText",value:function(){return!(!(t=this)||void 0===t.type||5!==t.type&&6!==t.type&&1!==t.type);var t}},{key:"isTag",value:function(){return!(!(t=this)||void 0===t.type)&&2===t.type;var t}},{key:"isAttrName",value:function(){return!(!(t=this)||void 0===t.type)&&3===t.type;var t}},{key:"isAttrValue",value:function(){return!(!(t=this)||void 0===t.type)&&4===t.type;var t}},{key:"isStart",value:function(){return!_(this)}},{key:"isEnd",value:function(){return _(this)}},{key:"getName",value:function(){return n=w(t=this),_(t)?n.slice(1):n;var t,n}},{key:"getValue",value:function(){return w(this)}},{key:"getLine",value:function(){return(t=this)&&t.line||0;var t}},{key:"getColumn",value:function(){return(t=this)&&t.row||0;var t}},{key:"toString",value:function(){return t=s,(t+=w(this))+f;var t}}])&&P(n.prototype,e),r&&P(n,r),t}();function j(t,n){var e={pos:0,len:t.length},r=function(){return e.len>e.pos},o=function(t,r){e.pos+=void 0===t?1:t,n&&n.onSkip&&!r&&n.onSkip()},i=function(){return t[e.pos]};this.skip=o,this.hasNext=r,this.getCurr=i,this.getRest=function(){return t.substr(e.pos)},this.getNext=function(){var n=e.pos+1;return n>t.length-1?null:t[n]},this.getPrev=function(){var n=e.pos-1;return void 0!==t[n]?t[n]:null},this.isLast=function(){return e.pos===e.len},this.includes=function(n){return t.indexOf(n,e.pos)>=0},this.grabWhile=function(n,a){var u=0;if(r())for(u=e.pos;r()&&n(i());)o(1,a);return t.substr(u,e.pos-u)},this.substrUntilChar=function(n){var r=e.pos,o=t.indexOf(n,r);return 0>o?"":t.substr(r,o-r)}}var R=function(t,n){return new j(t,n)};function B(t){var n=void 0===t?[]:t;this.push=function(t){return n.push(t)},this.toArray=function(){return n},this.getLast=function(){return Array.isArray(n)&&n.length>0&&void 0!==n[n.length-1]?n[n.length-1]:null},this.flushLast=function(){return!!n.length&&n.pop()}}var K=function(t){return new B(void 0===t?[]:t)};function H(t,n){var e=void 0===n?{}:n,g=function(t,n){var e=function(t,n,e,r){return new x(t,n,void 0===e?0:e,void 0===r?0:r)}(t,n,O,S);j(e),m[N+=1]=e},v=function(t,n){if(C===E){var e=t.grabWhile((function(t){return!(t===a||U(t))})),o=t.isLast(),i=t.getCurr()!==a;return t.skip(),o||i?g(4,I(e)):g(3,e),o?A:i?E:k}if(C===k){var c=!1;e=t.grabWhile((function(e){var o=e===u,i=t.getPrev(),s=t.getNext(),f=i===r,l=s===a,g=U(e),v=U(s);return!(!c||!q(e))||!!(!o||f||(c=!c)||l||v)&&(!!n||!1===g)}));return t.skip(),g(4,I(e)),t.isLast()?A:E}e=t.grabWhile((function(n){return!(n===a||U(n)||t.isLast())}));return g(2,e),t.skip(),n?k:t.includes(a)?E:k},p=function(){var t=J.getCurr();if(t===P){var n=J.getNext();J.skip();var e=J.substrUntilChar(w),r=0===e.length||e.indexOf(P)>=0;if(M(n)||r||J.isLast())return g(1,t),y;if(-1===e.indexOf(a)||e[0]===l){var o=J.grabWhile((function(t){return t!==w}));return J.skip(),g(2,o),y}return b}return y},h=function(){var t=J.grabWhile((function(t){return t!==w}),!0),n=R(t,{onSkip:F}),e=n.includes(c);for(C=A;n.hasNext();)C=v(n,!e);return J.skip(),y},d=function(){if(W(J.getCurr()))return g(6,J.getCurr()),J.skip(),S=0,O++,y;if(U(J.getCurr()))return g(5,J.grabWhile(U)),y;if(J.getCurr()===P)return J.includes(w)?T:(g(1,J.getCurr()),J.skip(),y);if(_){if(Q(J.getCurr())){var t=J.getCurr(),n=J.getNext();return J.skip(),z(n)?(J.skip(),g(1,n),y):(g(1,t),y)}return g(1,J.grabWhile((function(t){return D(t)&&!Q(t)}))),y}return g(1,J.grabWhile(D)),y},y=0,T=1,b=2,A=0,E=1,k=2,O=0,S=0,N=-1,L=y,C=A,m=Array(Math.floor(t.length)),P=e.openTag||s,w=e.closeTag||f,_=!!e.enableEscapeTags,j=e.onToken||function(){},B=[w,P,u,r,c,i,a,o,"!"],K=[P,c,i,o],H=[c,i],V=[a,c,i],M=function(t){return B.indexOf(t)>=0},W=function(t){return t===o},U=function(t){return H.indexOf(t)>=0},D=function(t){return-1===K.indexOf(t)},q=function(t){return V.indexOf(t)>=0},z=function(t){return t===P||t===w||t===r},Q=function(t){return t===r},F=function(){S++},I=function(t){return function(t,n){for(;t.charAt(0)===n;)t=t.substring(1);for(;t.charAt(t.length-1)===n;)t=t.substring(0,t.length-1);return t}(t,u).replace(r+u,u)},J=R(t,{onSkip:F});return{tokenize:function(){for(L=y;J.hasNext();)switch(L){case T:L=p();break;case b:L=h();break;case y:L=d();break;default:L=y}return m.length=N+1,m},isTokenNested:function(n){var e=P+l+n.getValue();return t.indexOf(e)>-1}}}var V=function(t,n){var e=void 0===n?{}:n,r=e,o=r.openTag||s,i=r.closeTag||f,a=null,u=K(),c=K(),l=K(),g=K(),v=new Set,p=function(){l.flushLast()&&g.flushLast()},h=function(t){var n,e,a=(n=c.getLast())&&Array.isArray(n.content)?n.content:u.toArray();Array.isArray(a)&&(E(t)?(e=t.tag,r.onlyAllowTags&&r.onlyAllowTags.length&&0>r.onlyAllowTags.indexOf(e)?(a.push(t.toTagStart({openTag:o,closeTag:i})),t.content.length&&(t.content.forEach((function(t){a.push(t)})),a.push(t.toTagEnd({openTag:o,closeTag:i})))):a.push(t.toTagNode())):a.push(t))},d=function(t){p();var n=k.create(t.getValue()),e=function(t){var n=t.getValue();return!v.has(n)&&a.isTokenNested&&a.isTokenNested(t)?(v.add(n),!0):v.has(n)}(t);l.push(n),e?c.push(n):h(n)},y=function(t){t.isStart()&&d(t),t.isEnd()&&function(t){p();var n=c.flushLast();if(n)h(n);else if("function"==typeof r.onError){var e=t.getValue(),o=t.getLine(),i=t.getColumn();r.onError({message:"Inconsistent tag '".concat(e,"' on line ").concat(o," and column ").concat(i),tagName:e,lineNumber:o,columnNumber:i})}}(t)},T=function(t){var n=l.getLast(),e=t.getValue(),r=!!v.has(t);if(n)if(t.isAttrName())g.push(e),n.attr(g.getLast(),"");else if(t.isAttrValue()){var o=g.getLast();o?(n.attr(o,e),g.flushLast()):n.attr(e,e)}else t.isText()?r?n.append(e):h(e):t.isTag()&&h(""+t);else t.isText()?h(e):t.isTag()&&h(""+t)};return(a=(e.createTokenizer?e.createTokenizer:H)(t,{onToken:function(t){t.isTag()?y(t):T(t)},onlyAllowTags:r.onlyAllowTags,openTag:o,closeTag:i,enableEscapeTags:r.enableEscapeTags})).tokenize(),u.toArray()};t.default=V,t.parse=V,Object.defineProperty(t,"__esModule",{value:!0})}));
